<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gerenciar Resenhas - Xis POA</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* SEUS ESTILOS ORIGINAIS - PRESERVADOS */
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 20px;
    }
    #resenhas-container {
      max-width: 800px;
      margin: 0 auto;
    }
    .resenha-card {
      background: white;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    #login-message {
      display: none;
      text-align: center;
      padding: 20px;
      background: white;
      border-radius: 8px;
      max-width: 500px;
      margin: 20px auto;
    }

    /* NOVOS ESTILOS DA BARRA DE EDIÇÃO (IGUAL AO admin.html) */
    .editor-toolbar {
      display: flex;
      gap: 5px;
      padding: 8px;
      background: #f0f0f0;
      border-radius: 6px 6px 0 0;
      border: 1px solid #ddd;
    }
    .editor-btn {
      padding: 5px 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background: #e0e0e0;
    }
    #editResenha {
      border-radius: 0 0 6px 6px;
      border-top: none;
    }
  </style>
</head>
<body>
  <h1 style="text-align: center; margin: 20px 0;">Gerenciar Resenhas</h1>
  
  <div id="resenhas-container">
    <p id="loading" style="text-align: center;">Carregando resenhas...</p>
  </div>

  <div id="login-message">
    <h2>Acesso Restrito</h2>
    <p>Por favor, <a href="admin.html" style="color: #ff6b6b;">faça login</a> para continuar.</p>
  </div>

  <!-- MODAL DE EDIÇÃO COM BARRA DE FERRAMENTAS NOVA -->
  <div class="edit-modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7);">
    <div class="edit-modal-content" style="background: white; margin: 5% auto; padding: 20px; width: 90%; max-width: 600px; border-radius: 8px;">
      <span class="close-edit" style="float: right; font-size: 24px; cursor: pointer;">&times;</span>
      <h2>Editar Resenha</h2>
      <form id="editForm">
        <input type="hidden" id="editId">
        
        <label for="editNome">Nome do Local:</label>
        <input type="text" id="editNome" required style="width: 100%; padding: 8px; margin-bottom: 10px;">
        
        <!-- BARRA DE FERRAMENTAS ADICIONADA -->
        <label for="editResenha">Resenha:</label>
        <div class="editor-toolbar">
          <button type="button" class="editor-btn" onclick="formatText('bold', 'editResenha')"><b>B</b></button>
          <button type="button" class="editor-btn" onclick="formatText('italic', 'editResenha')"><i>I</i></button>
          <button type="button" class="editor-btn" onclick="insertLink('editResenha')"><i class="fas fa-link"></i></button>
        </div>
        <textarea id="editResenha" rows="10" required style="width: 100%; padding: 8px;"></textarea>
        
        <button type="submit" style="background: #4CAF50; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; margin-top: 10px;">Salvar Alterações</button>
      </form>
    </div>
  </div>

  <!-- FIREBASE (CONFIGURAÇÃO ORIGINAL) -->
  <script src="https://www.gstatic.com/firebasejs/9.21.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.21.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.21.0/firebase-firestore-compat.js"></script>

  <script>
    // CONFIGURAÇÃO ORIGINAL DO SEU SITE
    const firebaseConfig = {
      apiKey: "FIREBASE_API_KEY",  // SERÁ SUBSTITUÍDO AUTOMATICAMENTE
      authDomain: "FIREBASE_PROJECT_ID.firebaseapp.com",
      projectId: "FIREBASE_PROJECT_ID",
      storageBucket: "FIREBASE_PROJECT_ID.appspot.com"
    };

    // INICIALIZAÇÃO ORIGINAL (SEM ALTERAÇÕES)
    let auth, db;
    try {
      if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
      }
      auth = firebase.auth();
      db = firebase.firestore();

      // VERIFICAÇÃO DE LOGIN ORIGINAL
      auth.onAuthStateChanged(user => {
        if (user) {
          document.getElementById('login-message').style.display = 'none';
          loadResenhas();
        } else {
          document.getElementById('loading').style.display = 'none';
          document.getElementById('login-message').style.display = 'block';
        }
      });

    } catch (error) {
      console.error("Erro Firebase:", error);
      document.getElementById('loading').innerHTML = "Erro de conexão";
    }

    // FUNÇÕES ORIGINAIS DO GERENCIAR.HTML
    async function loadResenhas() {
      try {
        const querySnapshot = await db.collection("locais").get();
        const container = document.getElementById("resenhas-container");
        container.innerHTML = '';
        
        querySnapshot.forEach(doc => {
          const data = doc.data();
          const card = document.createElement('div');
          card.className = 'resenha-card';
          card.innerHTML = `
            <h3>${data.nome}</h3>
            <p>${data.resenha}</p>
            <p>Nota: ${'⭐'.repeat(data.nota)}</p>
            <button onclick="openEditModal('${doc.id}')">Editar</button>
          `;
          container.appendChild(card);
        });
        
        document.getElementById('loading').style.display = 'none';
      } catch (error) {
        console.error("Erro ao carregar:", error);
      }
    }

    // FUNÇÃO PARA ABRIR MODAL DE EDIÇÃO
    window.openEditModal = async function(id) {
      const doc = await db.collection("locais").doc(id).get();
      if (doc.exists) {
        document.getElementById('editId').value = id;
        document.getElementById('editNome').value = doc.data().nome;
        document.getElementById('editResenha').value = doc.data().resenha;
        document.querySelector('.edit-modal').style.display = 'block';
      }
    };

    // FECHAR MODAL
    document.querySelector('.close-edit').addEventListener('click', () => {
      document.querySelector('.edit-modal').style.display = 'none';
    });

    // SALVAR EDIÇÃO
    document.getElementById('editForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const id = document.getElementById('editId').value;
      await db.collection("locais").doc(id).update({
        nome: document.getElementById('editNome').value,
        resenha: document.getElementById('editResenha').value
      });
      document.querySelector('.edit-modal').style.display = 'none';
      loadResenhas();
    });

    // FUNÇÕES DA BARRA DE FERRAMENTAS (IGUAL AO admin.html)
    function formatText(tag, textareaId) {
      const textarea = document.getElementById(textareaId);
      const start = textarea.selectionStart;
      const end = textarea.selectionEnd;
      const selectedText = textarea.value.substring(start, end);
      
      const tags = {
        bold: ['<b>', '</b>'],
        italic: ['<i>', '</i>'],
        underline: ['<u>', '</u>'],
        strike: ['<s>', '</s>']
      };
      
      textarea.value = textarea.value.substring(0, start) + 
                       tags[tag][0] + selectedText + tags[tag][1] + 
                       textarea.value.substring(end);
      
      textarea.focus();
      textarea.setSelectionRange(start + tags[tag][0].length, end + tags[tag][0].length);
    }

    function insertLink(textareaId) {
      const textarea = document.getElementById(textareaId);
      const url = prompt('Digite a URL do link:', 'https://');
      if (url) {
        const text = prompt('Texto do link:', textarea.value.substring(
          textarea.selectionStart, 
          textarea.selectionEnd
        ) || 'Clique aqui');
        
        if (text) {
          const html = `<a href="${url}" target="_blank">${text}</a>`;
          textarea.value = textarea.value.substring(0, textarea.selectionStart) + 
                          html + 
                          textarea.value.substring(textarea.selectionEnd);
        }
      }
    }
  </script>
</body>
</html>
