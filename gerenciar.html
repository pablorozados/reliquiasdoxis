<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <!-- ... (cabe√ßalho permanece igual) ... -->
</head>
<body>
  <h1>Gerenciar Resenhas</h1>
  <div id="resenhas-container">
    <p id="loading">Carregando suas resenhas...</p>
  </div>

  <div id="login-message" style="display: none;">
    <h2>Acesso Restrito</h2>
    <p>Voc√™ precisa estar logado para acessar esta p√°gina.</p>
    <p>Por favor, fa√ßa login na <a href="admin.html">√Årea do Dono</a> primeiro.</p>
  </div>

 <!-- Substitua todo o conte√∫do do script no gerenciar.html por este: -->
<script>
  // Configura√ß√£o do Firebase (j√° est√° correta no seu arquivo)
  const firebaseConfig = {
    apiKey: "AIzaSyA7_SFUPE6n9KG6LhL9Y6DRanSW5Zn0-2k",
    authDomain: "reliquias-do-xis.firebaseapp.com",
    projectId: "reliquias-do-xis",
    storageBucket: "reliquias-do-xis.appspot.com",
    messagingSenderId: "936551505510",
    appId: "1:936551505510:web:22de1482a8f8d9720257a7"
  };

  // Inicializa√ß√£o
  if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
  }
  const auth = firebase.auth();
  const db = firebase.firestore();

  // Elementos da UI
  const resenhasContainer = document.getElementById("resenhas-container");
  const loginMessage = document.getElementById("login-message");
  const loadingElement = document.getElementById("loading");

  // Fun√ß√£o para mostrar mensagem de n√£o autenticado
  function showLoginMessage() {
    resenhasContainer.style.display = "none";
    loginMessage.style.display = "block";
    loadingElement.style.display = "none";
  }

  // Fun√ß√£o para carregar TODAS as resenhas (sem filtro)
  async function loadResenhas() {
    try {
      loadingElement.textContent = "Carregando todas as resenhas...";
      
      const snapshot = await db.collection("locais")
        .orderBy("timestamp", "desc")
        .get();

      resenhasContainer.innerHTML = '';

      if (snapshot.empty) {
        resenhasContainer.innerHTML = '<p>Nenhuma resenha encontrada na cole√ß√£o "locais".</p>';
        return;
      }

      snapshot.forEach(doc => {
        const data = doc.data();
        const card = document.createElement('div');
        card.className = 'resenha-card';
        
        // Formata data corretamente
        const dataFormatada = data.timestamp?.toDate()?.toLocaleString('pt-BR') || 'Data n√£o dispon√≠vel';
        
        // Trata imagens (single ou array)
        let imagensHTML = '';
        if (data.imagem) {
          if (Array.isArray(data.imagem)) {
            imagensHTML = data.imagem.map(img => 
              `<img src="${img}" class="thumbnail" style="max-width: 200px; margin: 5px;">`
            ).join('');
          } else {
            imagensHTML = `<img src="${data.imagem}" class="thumbnail" style="max-width: 200px;">`;
          }
        }

        card.innerHTML = `
          <h3>${data.nome || 'Sem nome'}</h3>
          <p><strong>Data:</strong> ${dataFormatada}</p>
          <p><strong>Pedido:</strong> ${data.meu_pedido || 'N√£o informado'}</p>
          <p>${data.resenha || 'Sem resenha'}</p>
          ${imagensHTML}
          <div class="resenha-actions">
            <button onclick="deleteResenha('${doc.id}')">üóëÔ∏è Deletar</button>
          </div>
          <hr style="margin: 15px 0; border: 1px solid #eee;">
        `;
        resenhasContainer.appendChild(card);
      });

    } catch (error) {
      console.error("Erro ao carregar:", error);
      resenhasContainer.innerHTML = `
        <div style="color: red; padding: 20px; background: #ffeeee; border-radius: 8px;">
          <p><strong>Erro ao carregar resenhas:</strong></p>
          <p>${error.message}</p>
          <p>Verifique o console para detalhes.</p>
        </div>
      `;
    }
  }

  // Verifica√ß√£o de autentica√ß√£o
  auth.onAuthStateChanged(async (user) => {
    if (!user) {
      showLoginMessage();
      return;
    }

    try {
      await user.getIdToken(true);
      loadResenhas(); // Chama sem par√¢metro agora
    } catch (error) {
      console.error("Erro na autentica√ß√£o:", error);
      showLoginMessage();
    }
  });

  // Fun√ß√£o para deletar (agora mais robusta)
  window.deleteResenha = async (id) => {
    if (!auth.currentUser) {
      alert("‚ö†Ô∏è Sua sess√£o expirou. Por favor, fa√ßa login novamente.");
      showLoginMessage();
      return;
    }

    if (!confirm('Tem certeza ABSOLUTA que deseja deletar esta resenha?\n\nEssa a√ß√£o n√£o pode ser desfeita!')) return;
    
    try {
      await db.collection("locais").doc(id).delete();
      alert('‚úÖ Resenha deletada com sucesso!');
      loadResenhas(); // Recarrega a lista
    } catch (error) {
      alert(`‚ùå Erro ao deletar: ${error.message}`);
      console.error("Erro detalhado:", error);
    }
  };
</script>
</body>
</html>
